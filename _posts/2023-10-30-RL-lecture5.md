---
layout: post
title: ç¬¬äº”ç«  Policy Optimization Foundation (ç­–ç•¥ä¼˜åŒ–åŸºç¡€ç¯‡)
date: 2023-10-30
description: PO
tags: intro
categories: Reinforcement-Learning
giscus_comments: true
related_posts: true
toc:
  beginning: true
---

# ä¸€ã€åŸºäºç­–ç•¥çš„å¼ºåŒ–å­¦ä¹ 

1. åŸºäºä»·å€¼çš„RLå’ŒåŸºäºç­–ç•¥çš„RLæœ‰ä½•åŒºåˆ«ï¼Ÿ
    1. **å†³å®šæ€§ç­–ç•¥**æ˜¯ç›´æ¥é€šè¿‡è´ªå¿ƒç®—æ³•ï¼Œç”±ä»·å€¼å‡½æ•°ç”Ÿæˆæˆ‘ä»¬åº”è¯¥é‡‡å–çš„åŠ¨ä½œï¼š
        
        $$
        a_t=\arg \max _a Q\left(a, s_t\right)
        $$
        
    2. **éšæœºæ€§ç­–ç•¥**ï¼šæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥å»ºæ¨¡ç­–ç•¥å‡½æ•°ä¸ºä¸€ä¸ªå‚æ•°åŒ–æ¦‚ç‡åˆ†å¸ƒ$$\pi_{\theta}(a|s)$$ï¼Œå‚æ•°ä¸º$$\theta$$
        
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter5/Untitled.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>

        
    3. å¯¹æ¯”ï¼š
        
        
        | åŸºäºä»·å€¼çš„RL | åŸºäºç­–ç•¥çš„RL | æ¼”å‘˜-è¯„è®ºå‘˜ |
        | --- | --- | --- |
        | å­¦ä¹ ä»·å€¼å‡½æ•° | æ²¡æœ‰ä»·å€¼å‡½æ•° | åŒæ—¶å­¦ç­–ç•¥å’Œä»·å€¼å‡½æ•° |
        | é€šè¿‡ä»·å€¼å‡½æ•°å¾—åˆ°éšå¼çš„ç­–ç•¥ | ç›´æ¥å­¦ä¹ ç­–ç•¥ |  |
2. policy-based RLç‰¹ç‚¹: æœ‰ç‚¹ç±»ä¼¼ç›‘ç£å­¦ä¹ 
    1. ä¼˜åŠ¿ï¼š
        1. æ›´å¥½çš„æ”¶æ•›æ€§ï¼šå¯ä»¥ä¿è¯æ”¶æ•›ï¼Œè‡³å°‘æ˜¯local optimum
        2. ç­–ç•¥æ¢¯åº¦åœ¨é«˜ç»´åŠ¨ä½œç©ºé—´æ˜¯æ›´æœ‰æ•ˆçš„
        3. ç­–ç•¥æ¢¯åº¦å¯ä»¥å­¦ä¹ éšæœºç­–ç•¥ï¼Œä½†æ˜¯ä»·å€¼å‡½æ•°ä¸èƒ½ã€‚
    2. åŠ£åŠ¿ï¼š
        1. ç»å¸¸ä¼šæ”¶æ•›åˆ°å±€éƒ¨æœ€ä¼˜è§£
        2. ç­–ç•¥è¯„ä¼°ä¼šæœ‰å¾ˆå¤§çš„æ–¹å·®

# äºŒã€MCç­–ç•¥æ¢¯åº¦

## 2.1 ç­–ç•¥ä¼˜åŒ–

1. ç­–ç•¥ä¼˜åŒ–ç›®æ ‡ï¼šç»™å®šä¸€ä¸ªå¸¦å‚ $$\theta$$ ç­–ç•¥è¿‘ä¼¼å™¨ $$\pi_{\theta}(s,a)$$ï¼Œæ‰¾åˆ°æœ€ä¼˜$$\theta$$
2. å¦‚ä½•è¡¡é‡ç­–ç•¥ $$\pi_{\theta}(s,a)$$ çš„è´¨é‡ï¼Ÿ
    1. åœ¨ç¦»æ•£ï¼ˆæœ‰è½®æ•°ï¼‰ç¯å¢ƒä¸­æˆ‘ä»¬ç”¨**å¼€å§‹ä»·å€¼**
        
        $$
        J_1(\theta)=V^{\pi_\theta}\left(s_1\right)=\mathbb{E}_{\pi_\theta}\left[v_1\right]
        $$
        
    2. åœ¨è¿ç»­çš„ç¯å¢ƒï¼ˆæ²¡æœ‰ç»ˆæ­¢ï¼‰æˆ‘ä»¬å¯ä»¥ç”¨**ä»·å€¼å‡å€¼**æˆ–è€…**å›æŠ¥å‡å€¼**
        - ä»·å€¼å‡å€¼ï¼š
            
            $$
            J_{a v V}(\theta)=\sum_s d^{\pi_\theta}(s) V^{\pi_\theta}(s)
            $$
            
        - å›æŠ¥å‡å€¼ï¼š
            
            $$
            J_{a v R}(\theta)=\sum_s d^{\pi_\theta}(s) \sum_a \pi_\theta(s, a) R(s, a)
            $$
            
            å…¶ä¸­$$\pi_\theta$$çš„é©¬å°”å¯å¤«åˆ†å¸ƒç¨³æ€åˆ†å¸ƒæ˜¯$$d^{\pi_\theta}$$ã€‚
            
3. ç­–ç•¥ä»·å€¼ï¼šå’Œæˆ‘ä»¬åœ¨åŸºäºä»·å€¼çš„RLä¸­å®šä¹‰ä¸€æ ·ã€‚
    
    $$
    \begin{aligned}J(\theta) & =\mathbb{E}_{\tau \sim \pi_\theta}\left[\sum_t R\left(s_t^\tau, a_t^\tau\right)\right] \\& \approx \frac{1}{m} \sum_m \sum_t R\left(s_t^m, a_t^m\right)\end{aligned}
    $$
    
    - $$\tau$$æ˜¯æˆ‘ä»¬ä»ç­–ç•¥å‡½æ•°$$\pi_\theta$$ä¸­çš„é‡‡æ ·è½¨è¿¹
    - æˆ‘ä»¬å¿½ç•¥æŠ˜æ‰£
4. åŸºäºç­–ç•¥çš„RLçš„ç›®æ ‡ï¼šæ‰¾åˆ°å‚æ•°ä½¿å¾—$$J(\theta)$$æœ€å¤§åŒ–
    
    $$
    \theta^*=\underset{\theta}{\arg \max } \mathbb{E}_{\tau \sim \pi_\theta}\left[\sum_t R\left(s_t^\tau, a_t^\tau\right)\right]
    $$
    
    - å¦‚æœ$$J(\theta)$$å¯å¾®ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åŸºäºæ¢¯åº¦çš„æ–¹æ³•è§£
        
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter5/Untitled 1.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>

        
    - å¦‚æœ$$J(\theta)$$ä¸å¯å¾®æˆ–è€…éš¾ä»¥æ±‚å¯¼ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€äº›ä¸ç”¨æ¢¯åº¦çš„é»‘ç›’ä¼˜åŒ–æ–¹æ³•ï¼š
        - äº¤å‰ç†µæ³• (CEM)
            
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter5/Untitled 2.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>

            
        - æœ‰é™å·®åˆ†
            
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter5/Untitled 3.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>

            
5. è®¡ç®—ç­–ç•¥æ¢¯åº¦ï¼š
    1. å‡è®¾ç­–ç•¥é0æ—¶å¤„å¤„å¯å¾®ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—æ¢¯åº¦$$\nabla_\theta \pi_\theta(s, a)$$
    2. ä¸€ä¸ªè®¡ç®—trick (likelihood ratios)ï¼šä¼˜åŒ–ç›®æ ‡å°±æ˜¯$$\nabla_\theta \log \pi_\theta(s, a)$$
        
        $$
        \textcolor{blue}{\begin{aligned}\nabla_\theta \pi_\theta(s, a) & =\pi_\theta(s, a) \frac{\nabla_\theta \pi_\theta(s, a)}{\pi_\theta(s, a)} \\& =\pi_\theta(s, a) \nabla_\theta \log \pi_\theta(s, a)\end{aligned}}
        $$
        
    - ä¾‹1ï¼šé«˜æ–¯ç­–ç•¥
        
        åœ¨è¿ç»­åŠ¨ä½œç©ºé—´ï¼Œä¸€ä¸ªé«˜æ–¯ç­–ç•¥çš„å®šä¹‰ååˆ†è‡ªç„¶ã€‚å…¶å‡å€¼æ˜¯çŠ¶æ€ç‰¹å¾çš„çº¿æ€§ç»„åˆï¼š$$\mu(s)=\phi(s)^T \theta$$ã€‚æ–¹å·®å¯ä»¥æ˜¯å‚æ•°åŒ–çš„ä¹Ÿå¯ä»¥æ˜¯å¸¸æ•°ã€‚ç­–ç•¥æ˜¯è¿ç»­ã€é«˜æ–¯çš„ï¼Œå³$$a \sim \mathcal{N}\left(\mu(s), \sigma^2\right)$$
        
        é‚£ä¹ˆåˆ†æ•°ä¸ºï¼š
        
        $$
        \nabla_\theta \log \pi_\theta(s, a)=\frac{(a-\mu(s)) \phi(s)}{\sigma^2}
        $$
        
    - ä¾‹2ï¼šsoftmaxç­–ç•¥
        
        ç®€å•ç­–ç•¥æ¨¡å‹ï¼Œç”¨ç‰¹å¾çº¿æ€§ç»„åˆä½œä¸ºåŠ¨ä½œæƒé‡ã€‚å…¶åŠ¨ä½œæ¦‚ç‡å’Œæƒé‡å¤§å°æŒ‡æ•°æˆæ­£æ¯”ï¼Œå³
        
        $$
        \pi_\theta(s, a)=\frac{\exp ^{\phi(s, a)^T \theta}}{\sum_{a^{\prime}} \exp ^{\phi\left(s, a^{\prime}\right)^T \theta}}
        $$
        
        é‚£ä¹ˆåˆ†æ•°ä¸ºï¼š
        
        $$
        \nabla_\theta \log \pi_\theta(s, a)=\phi(s, a)-\mathbb{E}_{\pi_\theta}[\phi(s, .)]
        $$
        

## 2.2 å•æ­¥MDPçš„ç­–ç•¥æ¢¯åº¦

è€ƒè™‘å•æ­¥MDPçš„ç®€å•æƒ…å†µï¼š ä»çŠ¶æ€$$s\sim d(s)$$å¼€å§‹ï¼Œåˆ°ä¸€ä¸ªæ—¶é—´å•ä½åç»“æŸï¼Œå¥–åŠ±ä¸º$$r=R(s,a)$$ã€‚æˆ‘ä»¬ç”¨ä¼¼ç„¶æ¯”ä¾‹å»è®¡ç®—ç­–ç•¥æ¢¯åº¦ï¼š

$$
\begin{aligned}J(\theta)  =\mathbb{E}_{\pi_\theta}[r]  =\sum_{s \in \mathcal{S}} d(s) \sum_{a \in \mathcal{A}} \pi_\theta(s, a) r\end{aligned}
$$

å…¶æ¢¯åº¦ä¸ºï¼š

$$
\begin{aligned}\nabla_\theta J(\theta) & =\sum_{s \in \mathcal{S}} d(s) \sum_{a \in \mathcal{A}} \pi_\theta(s, a) \nabla_\theta \log \pi_\theta(s, a) r \\& =\mathbb{E}_{\pi_\theta}\left[r \nabla_\theta \log \pi_\theta(s, a)\right]\end{aligned}
$$

## 2.3 å¤šæ­¥MDPçš„ç­–ç•¥æ¢¯åº¦

1. ä¸€å›åˆçš„è½¨è¿¹å¯ä»¥è¡¨ç¤ºä¸ºï¼š$$\tau=\left(s_0, a_0, r_1, \ldots s_{T-1}, a_{T-1}, r_T, s_T\right) \sim\left(\pi_\theta, P\left(s_{t+1} \mid s_t, a_t\right)\right)$$
2. å…¶è½¨è¿¹çš„å¥–åŠ±ä¸º$$R(\tau)=\sum_{t=0}^{T-1} R\left(s_t, a_t\right)$$
3. ç­–ç•¥ç›®æ ‡ä¸ºï¼š
    
    $$
    J(\theta)=\mathbb{E}_{\pi_\theta}\left[\sum_{t=0}^{T-1} R\left(s_t, a_t\right)\right]=\sum_\tau P(\tau ; \theta) R(\tau)
    $$
    
    å…¶ä¸­$$P(\tau ; \theta)=d(s_0)\pi_{\theta}(a_0|s_0)p(s_1|s_0,a_0)\cdots \pi_{\theta}(a_{T-1}|s_{T-1})p(s_T|s_{T-1},a_{T-1})=d\left(s_0\right) \prod_{t=0}^{T-1} \pi_\theta\left(a_t \mid s_t\right) p\left(s_{t+1} \mid s_t, a_t\right)$$è¡¨ç¤ºæ‰§è¡Œç­–ç•¥$$\pi_\theta$$æ—¶åœ¨è½¨è¿¹ä¸­çš„æ¦‚ç‡
    
4. æ€»ä½“ç›®æ ‡ï¼šmax $$J(\theta)$$
    
    $$
    \theta^*=\underset{\theta}{\arg \max } J(\theta)=\underset{\theta}{\arg \max } \sum_\tau P(\tau ; \theta) R(\tau)
    $$
    
5. è®¡ç®—æ¢¯åº¦ï¼š
    
    $$
    \begin{aligned}\nabla_\theta J(\theta) & =\nabla_\theta \sum_\tau P(\tau ; \theta) R(\tau) \\& =\sum_\tau \nabla_\theta P(\tau ; \theta) R(\tau) \\& =\sum_\tau \frac{P(\tau ; \theta)}{P(\tau ; \theta)} \nabla_\theta P(\tau ; \theta) R(\tau) \\& =\sum_\tau P(\tau ; \theta) R(\tau) \frac{\nabla_\theta P(\tau ; \theta)}{P(\tau ; \theta)} \\& =\sum_\tau P(\tau ; \theta) R(\tau) \nabla_\theta \log P(\tau ; \theta)\end{aligned}
    $$
    
6. ç»éªŒä¼°è®¡ç­–ç•¥ï¼Œè¿‘ä¼¼ï¼š
    
    $$
    \nabla_\theta J(\theta) \approx \frac{1}{m} \sum_{i=1}^m R\left(\tau_i\right) \nabla_\theta \log P\left(\tau_i ; \theta\right)
    $$
    
7. åˆ†è§£è½¨è¿¹ä¸ºçŠ¶æ€å’ŒåŠ¨ä½œ $$\nabla_\theta \log P(\tau ; \theta)$$ 
    
    $$
    \begin{aligned}\nabla_\theta \log P(\tau ; \theta) & =\nabla_\theta \log \left[d\left(s_0\right) \prod_{t=0}^{T-1} \pi_\theta\left(a_t \mid s_t\right) p\left(s_{t+1} \mid s_t, a_t\right)\right] \\& =\nabla_\theta\left[\log d\left(s_0\right)+\sum_{t=0}^{T-1} \log \pi_\theta\left(a_t \mid s_t\right)+\log p\left(s_{t+1} \mid s_t, a_t\right)\right] \\& =\sum_{t=0}^{T-1} \nabla_\theta \log \pi_\theta\left(a_t \mid s_t\right)\end{aligned}
    $$
    
    $$
    \textcolor{blue}{\nabla_\theta J(\theta) \approx \frac{1}{m} \sum_{i=1}^m R\left(\tau_i\right) \sum_{t=0}^{T-1} \nabla_\theta \log \pi_\theta\left(a_t^i \mid s_t^i\right)}
    $$
    
    æˆ‘ä»¬ä¸éœ€è¦çŸ¥é“**è½¬ç§»æ¨¡å‹**ã€‚
    

# ä¸‰ã€å‡å°‘ç­–ç•¥æ¢¯åº¦çš„æ–¹å·®

## 3.1 ç†è§£æ¢¯åº¦ä¼˜åŒ–çš„è¿‡ç¨‹

æˆ‘ä»¬è€ƒå¯Ÿçš„æ¢¯åº¦æ˜¯$$E_{\tau \sim \pi_\theta}[R(\tau)]$$.æ›´ä¸€èˆ¬çš„ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è®¡ç®—å‡½æ•°$$f(x)$$çš„æœŸæœ›ï¼Œæˆ‘ä»¬æœ‰ï¼š

$$
\begin{aligned}\nabla_\theta \mathbb{E}_{p(x ; \theta)}[f(x)] & =\mathbb{E}_{p(x ; \theta)}\left[f(x) \nabla_\theta \log p(x ; \theta)\right] \\& \approx \frac{1}{S} \sum_{s=1}^S f\left(x_s\right) \nabla_\theta \log p\left(x_s ; \theta\right), \text { where } x_s \sim p(x ; \theta)\end{aligned}
$$

1. å¦‚ä½•ç†è§£æ¢¯åº¦ï¼š
    1. ç§»åŠ¨åˆ†å¸ƒ$$p$$ï¼ˆä¼˜åŒ–å‚æ•°$$\theta$$ï¼‰ä½¿å¾—å…¶æœªæ¥çš„æ ·æœ¬$$x$$å¯ä»¥å¾—åˆ°æ›´é«˜çš„åˆ†æ•°
    2. å‘é‡$$f(x)\nabla_\theta \log p(x;\theta)$$æŠŠæ ·æœ¬çš„log-likelihoodæ¨å‘ä¸€ä¸ªè¡¨ç¤ºå®ƒçš„åˆ†æ•°ã€‚
        
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter5/Untitled 4.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>

        
2. ä¸æå¤§ä¼¼ç„¶æ¯”è¾ƒï¼š
    1. ç­–ç•¥æ¢¯åº¦ä¼°è®¡ï¼š
        
        $$
        \nabla_\theta J(\theta) \approx \frac{1}{M} \sum_{m=1}^M\left(\sum_{t=1}^T \nabla_\theta \log \pi_\theta\left(a_{t, m} \mid s_{t, m}\right)\right)\textcolor{red}{\left(\sum_{t=1}^T r\left(s_{t, m}, a_{t, m}\right)\right)}
        $$
        
    2. æå¤§ä¼¼ç„¶ä¼°è®¡ï¼š
        
        $$
        \nabla_\theta J_{M L}(\theta) \approx \frac{1}{M} \sum_{m=1}^M\left(\sum_{t=1}^T \nabla_\theta \log \pi_\theta\left(a_{t, m} \mid s_{t, m}\right)\right)
        $$
        
    
    ä¸»è¦åŒºåˆ«ï¼š**ç»™å¥½çš„åŠ¨ä½œæ›´å¤§çš„å¯èƒ½æ€§ï¼Œç»™ä¸å¥½çš„åŠ¨ä½œæ›´å°çš„å¯èƒ½æ€§**
    

## 3.2 ç­–ç•¥æ¢¯åº¦ä¸­æ–¹å·®è¾ƒå¤§çš„é—®é¢˜

1. æˆ‘ä»¬çš„ä¼˜åŒ–å¦‚ä¸‹ï¼š
    
    $$
    \nabla_\theta J(\theta) \approx \frac{1}{m} \sum_{i=1}^m R\left(\tau_i\right) \sum_{t=0}^{T-1} \nabla_\theta \log \pi_\theta\left(a_t^i \mid s_t^i\right)
    $$
    
    - å°½ç®¡æ˜¯Unbiasedï¼Œä½†æ˜¯å¾ˆNoisy
    - å¦‚ä½•ä¿®æ”¹ï¼Ÿ
        - ç”¨æ—¶é—´å› æœ
        - å¼•å…¥baseline
2. é€šè¿‡æ—¶é—´å› æœè§£å†³å¤§æ–¹å·®é—®é¢˜ï¼š
    1. æ­¤å‰æˆ‘ä»¬æœ‰ï¼š$$\nabla_\theta \mathbb{E}_\tau[R]=\mathbb{E}_\tau \left[\left(\sum_{t=0}^{T-1} r_t\right)\left(\sum_{t=0}^{T-1} \nabla_\theta \log \pi_\theta\left(a_t \mid s_t\right)\right)\right]$$
    2. æˆ‘ä»¬å¯ä»¥å¾—åˆ°æŸä¸€æ—¶åˆ»çš„å•ä¸€å¥–åŠ±ï¼š
        
        $$
        \nabla_\theta \mathbb{E}_\tau\left[r_{t^{\prime}}\right]=\mathbb{E}_\tau\left[r_{t^{\prime}} \sum_{t=0}^{t^{\prime}} \nabla_\theta \log \pi_\theta\left(a_t \mid s_t\right)\right]
        $$
        
    3. é€šè¿‡å¯¹$$t$$æ±‚å’Œï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼š
        
        $$
        \begin{aligned}\nabla_\theta J(\theta)=\nabla_\theta \mathbb{E}_{\tau \sim \pi_\theta}[R] & =\mathbb{E}_\tau\left[\sum_{t^{\prime}=0}^{T-1} r_{t^{\prime}} \sum_{t=0}^{t^{\prime}} \nabla_\theta \log \pi_\theta\left(a_t \mid s_t\right)\right] \\& =\mathbb{E}_\tau\left[\sum_{t=0}^{T-1} \nabla_\theta \log \pi_\theta\left(a_t \mid s_t\right) \sum_{\textcolor{red}{t^{\prime}=t}}^{T-1} r_{t^{\prime}}\right] \\& =\mathbb{E}_\tau\left[\sum_{t=0}^{T-1} G_t \cdot \nabla_\theta \log \pi_\theta\left(a_t \mid s_t\right)\right]\end{aligned}
        $$
        
    4. å› æ­¤æˆ‘ä»¬æœ‰ï¼š
        
        $$
        \nabla_\theta \mathbb{E}_{\tau \sim \pi_\theta}[R]=\mathbb{E}_\tau\left[\sum_{t=0}^{T-1} G_t \cdot \nabla_\theta \log \pi_\theta\left(a_t \mid s_t\right)\right]
        $$
        
        - $$G_t=\sum_{t^{\prime}=t}^{T-1} r_{t^{\prime}}$$ æ˜¯$$t$$æ­¥è½¨è¿¹ä¸­çš„å›æŠ¥
        - å› æœï¼šæ—¶é—´é åçš„ç­–ç•¥ä¸èƒ½å½±å“æ—¶é—´é å‰çš„ç­–ç•¥
        - æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„ä¼°è®¡æ›´æ–°ï¼š
        
        $$
        \nabla_\theta \mathbb{E}[R] \approx \frac{1}{m} \sum_{i=1}^m \sum_{t=0}^{T-1} G_t^{(i)} \cdot \nabla_\theta \log \pi_\theta\left(a_t^i \mid s_t^i\right)
        $$
        
    
    <aside>
    ğŸ˜ ä¾‹ï¼š**REINFORCE: ä¸€ç§MCç­–ç•¥æ¢¯åº¦ç®—æ³•**
    
    ç®—æ³•ç®€å•ä»ç­–ç•¥ä¸­é‡‡æ ·å¤šä¸ªè½¨è¿¹çš„æ ·æœ¬ï¼Œå¹¶ä¸”åŒæ—¶æ›´æ–°$$\theta$$å‚æ•°ï¼š
    
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter5/Untitled 5.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>

    
    </aside>
    
3. é€šè¿‡å¼•å…¥baselineè§£å†³æ–¹å·®å¤§çš„é—®é¢˜ï¼š
    1. åŸå§‹æ›´æ–°ï¼š$$G_t=\sum_{t^{\prime}=t}^{T-1} r_{t^{\prime}}$$å¯èƒ½æœ‰å¾ˆå¤§çš„æ–¹å·®
        
        $$
        \nabla_\theta \mathbb{E}_{\tau \sim \pi_\theta}[R]=\mathbb{E}_\tau\left[\sum_{t=0}^{T-1} \textcolor{red}{G_t} \cdot \nabla_\theta \log \pi_\theta\left(a_t \mid s_t\right)\right]
        $$
        
    2. å¯ä»¥é€šè¿‡å‡å»ä¸€ä¸ªbaselineæ¥å‡å°æ–¹å·®
        
        $$
        \nabla_\theta \mathbb{E}_{\tau \sim \pi_\theta}[R]=\mathbb{E}_\tau\left[\sum_{t=0}^{T-1} \textcolor{red}{(G_t-b(s_t))} \cdot \nabla_\theta \log \pi_\theta\left(a_t \mid s_t\right)\right]
        $$
        
    3. ä¸€ä¸ªå¥½çš„baselineå°±æ˜¯æœŸæœ›å¥–åŠ±ï¼š
        
        $$
        b\left(s_t\right)=\mathbb{E}\left[r_t+r_{t+1}+\ldots+r_{T-1}\right]
        $$
        
    4. è§£é‡Šï¼šæˆ‘ä»¬ä¼˜åŒ–çš„ä¸å†æ˜¯$$G_t$$æœ¬èº«ï¼Œè€Œæ˜¯$$G_t$$å¯ä»¥æ¯”baselineå¥½å¤šå°‘ã€‚å¯ä»¥è¯æ˜è¿™æ ·å¯ä»¥é™ä½æ–¹å·®ï¼š
        
        $$
        \begin{aligned}\mathbb{E}_\tau\left[\nabla_\theta \log \pi_\theta\left(a_t \mid s_t\right) b\left(s_t\right)\right] & =0, \\E_\tau\left[\nabla_\theta \log \pi_\theta\left(a_t \mid s_t\right)\left(G_t-b\left(s_t\right)\right)\right] & =E_\tau\left[\nabla_\theta \log \pi_\theta\left(a_t \mid s_t\right) G_t\right] \\\operatorname{Var}_\tau\left[\nabla_\theta \log \pi_\theta\left(a_t \mid s_t\right)\left(G_t-b\left(s_t\right)\right)\right] & <\operatorname{Var}_\tau\left[\nabla_\theta \log \pi_\theta\left(a_t \mid s_t\right) G_t\right]\end{aligned}
        $$
        
    5. åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç»™baselineä¸€ä¸ªå‚æ•°æ¥è¿›è¡Œå­¦ä¹ ï¼š
        
        $$
        \nabla_\theta \mathbb{E}_{\tau \sim \pi_\theta}[R]=\mathbb{E}_\tau\left[\sum_{t=0}^{T-1} \textcolor{red}{(G_t-b_{\mathbf{w}}(s_t))} \cdot \nabla_\theta \log \pi_\theta\left(a_t \mid s_t\right)\right]
        $$
        
        $$\mathbf{w}$$ç”¨äºè®­ç»ƒbaselineï¼Œå› æ­¤æˆ‘ä»¬æœ‰ä¸¤å¥—å‚æ•°ï¼š$$\mathbf{w}$$å’Œ$$\theta$$.
        
    
    <aside>
    ğŸ˜ å¸¦æœ‰baselineçš„ç­–ç•¥æ¢¯åº¦ç®—æ³•ï¼š
    
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter5/Untitled 6.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>

    
    </aside>
    

# å››ã€**æ¼”å‘˜-è¯„è®ºå‘˜**

1. é™¤äº†å¼•å…¥baselineå’Œæ—¶é—´å› æœï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å¼•å…¥Criticçš„æ–¹å¼æ¥é™ä½æ–¹å·®ï¼Œè¿™å°±å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ç®—æ³•ã€‚
    
    $$
    \nabla_\theta \mathbb{E}_{\tau \sim \pi_\theta}[R]=\mathbb{E}_\tau\left[\sum_{t=0}^{T-1} \textcolor{red}{G_t} \cdot \nabla_\theta \log \pi_\theta\left(a_t \mid s_t\right)\right]
    $$
    
    - å®è·µä¸Š$$G_t$$æ˜¯MCç­–ç•¥æ¢¯åº¦çš„ä¸€ä¸ªæ ·æœ¬ï¼Œæ˜¯å¯¹$$Q^{\pi_\theta}(s_t,a_t)$$çš„ä¸€ä¸ªunbiased noisyä¼°è®¡ã€‚
    - å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥ä¸ç”¨$$G_t$$ï¼Œè€Œç”¨ä¸€ä¸ªè¯„è®ºå‘˜å»ä¼°è®¡Qå‡½æ•°ã€‚
        
        $$
        Q_{\mathbf{w}}(s, a) \approx Q^{\pi_\theta}(s, a)
        $$
        
        $$
        \nabla_\theta J(\theta)=\mathbb{E}_{\pi_\theta}\left[\sum_{t=0}^{T-1} Q_{\textcolor{red}{\mathbf{w}}}\left(s_t, a_t\right) \cdot \nabla_\theta \log \pi_{\textcolor{red}\theta}\left(a_t \mid s_t\right)\right]
        $$
        
2. ä¸Šå¼å°±æ˜¯Actor-Criticç­–ç•¥æ¢¯åº¦ï¼š
    - Actorï¼špolicy functionï¼Œç”¨äºç”ŸæˆåŠ¨ä½œï¼Œå­¦ä¹ å‚æ•°$$\theta$$
    - Criticï¼švalue functionï¼Œè¡¡é‡åŠ¨ä½œçš„å›æŠ¥ï¼Œå­¦ä¹ å‚æ•°$$\mathbf{w}$$
        
        > Criticï¼šç±»ä¼¼äºç­–ç•¥è¯„ä¼°çš„ä½œç”¨
        > 

## 4.1 åŠ¨ä½œä»·å€¼åŠ¨ä½œè¯„è®ºå‘˜ç®—æ³•(QAC)

1. ç”¨ä¸€ä¸ªçº¿æ€§ä»·å€¼å‡½æ•°è¿‘ä¼¼ï¼š
    
    $$
    Q_{\mathbf{w}}(s, a)=\psi(s, a)^T \mathbf{w}
    $$
    
    å…¶ä¸­ï¼Œè¯„è®ºå‘˜ç”¨ä¸€ä¸ªçº¿æ€§TD(0)æ¥æ›´æ–°å‚æ•°$$\mathbf{w}$$ï¼ŒäºŒæ¼”å‘˜é€šè¿‡ç­–ç•¥æ¢¯åº¦æ›´æ–°å‚æ•°$$\theta$$.
    
2. å…·ä½“ç®—æ³•æµç¨‹ï¼š
3. æ¼”å‘˜-è¯„è®ºå‘˜å‡½æ•°è¿‘ä¼¼æ–¹æ³•ï¼š
    
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter5/Untitled 7.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>


æˆ‘ä»¬å¯ä»¥æœ‰ä¸¤ä¸ªä¸åŒçš„å‡½æ•°æ¥è¿‘ä¼¼ç­–ç•¥å‡½æ•°å’Œä»·å€¼å‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªå…±äº«çš„ç½‘ç»œæ¥æ¶‰åŠåŒæ—¶å¾—åˆ°ä¸¤ä¸ªå‡½æ•°ã€‚

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter5/Untitled 8.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>


## 4.2 å¸¦baslineçš„æ¼”å‘˜-è¯„è®ºå‘˜ç®—æ³•(A2C & TDAC)

1. æˆ‘ä»¬å®šä¹‰Qå‡½æ•°å¦‚ä¸‹ï¼š
    
    $$
    Q^{\pi, \gamma}(s, a)=\mathbb{E}_\pi\left[r_1+\gamma r_2+\ldots \mid s_1=s, a_1=a\right]
    $$
    
    é‚£ä¹ˆå…¶å®ä»·å€¼å‡½æ•°å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„baselineï¼š
    
    $$
    \begin{aligned}V^{\pi, \gamma}(s) & =\mathbb{E}_\pi\left[r_1+\gamma r_2+\ldots \mid s_1=s\right] \\& =\mathbb{E}_{a \sim \pi}\left[Q^{\pi, \gamma}(s, a)\right]\end{aligned}
    $$
    
2. advantage functionï¼šæˆ‘ä»¬å®šä¹‰å¸¦æœ‰baselineï¼ˆä»·å€¼å‡½æ•°ï¼‰çš„Qå‡½æ•°ä¸ºadvantage functionï¼Œå³
    
    $$
    A^{\pi, \gamma}(s, a)=Q^{\pi, \gamma}(s, a)-V^{\pi, \gamma}(s)
    $$
    
3. ç­–ç•¥æ¢¯åº¦ä¸ºï¼š
    
    $$
    \nabla_\theta J(\theta)=\mathbb{E}_{\pi_\theta}\left[\nabla_\theta \log \pi_\theta(s, a) A^{\pi, \gamma}(s, a)\right]
    $$
    
4. åœ¨ç­–ç•¥æ¢¯åº¦é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨MCæ¥ä¼°è®¡å›æŠ¥ï¼Œä¹Ÿå¯ä»¥ç”¨TDæ–¹æ³•æ¥ä¼°è®¡ã€‚å¦‚æœæˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªnæ­¥çš„å›æŠ¥ï¼Œæˆ‘ä»¬æœ‰ï¼š
    
    $$
    \begin{aligned}n=1(T D) & G_t^{(1)}=r_{t+1}+\gamma v\left(s_{t+1}\right) \\n=2 \quad & G_t^{(2)}=r_{t+1}+\gamma r_{t+2}+\gamma^2 v\left(s_{t+2}\right) \\n=\infty(M C) & G_t^{(\infty)}=r_{t+1}+\gamma r_{t+2}+\ldots+\gamma^{T-t-1} r_T\end{aligned}
    $$
    
    é‚£ä¹ˆæˆ‘ä»¬çš„advantage functionä¼°è®¡å¯ä»¥å†™ä¸ºï¼š
    
    $$
    \begin{aligned}& \hat{A}_t^{(1)}=r_{t+1}+\gamma v\left(s_{t+1}\right)-v\left(s_t\right) \\& \hat{A}_t^{(2)}=r_{t+1}+\gamma r_{t+2}+\gamma^2 v\left(s_{t+2}\right)-v\left(s_t\right) \\& \hat{A}_t^{(\infty)}=r_{t+1}+\gamma r_{t+2}+\ldots+\gamma^{T-t-1} r_T-v\left(s_t\right)\end{aligned}
    $$
    
    æ³¨æ„åˆ°ï¼Œ$$\hat{A}^{(\infty)}$$æœ‰å¤§varï¼Œå°biasï¼Œè€Œ$$\hat{A}^{(1)}$$æœ‰å°varï¼Œå¤§biasã€‚
    
5. ä¸åŒæ—¶é—´å°ºåº¦çš„æ¼”å‘˜ï¼š
    
    ç­–ç•¥æ¢¯åº¦å¯ä»¥åœ¨å¾ˆå¤šæ—¶é—´å°ºåº¦ä¸Šä¼°è®¡
    
    $$
    \nabla_\theta J(\theta)=\mathbb{E}_{\pi_\theta}\left[\nabla_\theta \log \pi_\theta(s, a) A^{\pi_\theta}(s, a)\right]
    $$
    
    - MCæ¼”å‘˜-è¯„è®ºå‘˜ç­–ç•¥æ¢¯åº¦ç”¨**æ•´ä¸ªå›æŠ¥**è¯¯å·®æ¥ä¼˜åŒ–ï¼š
        
        $$
        \nabla_\theta J(\theta)=\alpha\left(G_t-V_\kappa\left(s_t\right)\right) \nabla_\theta \log \pi_\theta\left(s_t, a_t\right)
        $$
        
    - TDæ¼”å‘˜-è¯„è®ºå‘˜ç­–ç•¥æ¢¯åº¦ç”¨TDè¯¯å·®æ¥ä¼˜åŒ–ï¼š
        
        $$
        \nabla_\theta J(\theta)=\alpha\left(r+\gamma V_\kappa\left(s_{t+1}\right)-V_\kappa\left(s_t\right)\right) \nabla_\theta \log \pi_\theta\left(s_t, a_t\right)
        $$
        
    - kæ­¥TDæ¼”å‘˜-è¯„è®ºå‘˜ç­–ç•¥æ¢¯åº¦ç”¨kæ­¥å›æŠ¥è¯¯å·®æ¥ä¼˜åŒ–ï¼š
        
        $$
        \nabla_\theta J(\theta)=\alpha\left(\sum_{i=0}^k \gamma^i r_{t+i}+\gamma^k V_\kappa\left(s_{t+k}\right)-V_\kappa\left(s_t\right)\right) \nabla_\theta \log \pi_\theta\left(s_t, a_t\right)
        $$
        
    
    > TDç®—æ³•åªéœ€è¦ä¼˜åŒ–criticçš„å‚æ•°$$\kappa$$ï¼
    > 

# äº”ã€ç­–ç•¥æ¢¯åº¦å°ç»“

1. ç­–ç•¥æ¢¯åº¦å¯ä»¥è§£å†³ä¸å¯å¾®çš„æƒ…å½¢ï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡éšæœºç­–ç•¥é‡‡æ ·æ¥ç»“ç®—
    
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter5/Untitled 9.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>

    
2. è®­ç»ƒè¿‡ç¨‹ä¸­æˆ‘ä»¬ä¼šäº§ç”Ÿä¸€äº›æ ·æœ¬ï¼ˆå›¾ä¸­ä¸åŒåˆ†æ”¯ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è®©ä¸åŒæ ·æœ¬å°½å¯èƒ½å¾—åˆ°æ¯”è¾ƒå¥½çš„ç»“æœï¼ˆæ¯”å¦‚å°çš„lossï¼‰ã€‚
    
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter5/Untitled 10.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>

    

3. ç­–ç•¥æ¢¯åº¦æ‹“å±•ï¼šå¤§éƒ¨åˆ†SOTAçš„RLæ–¹æ³•éƒ½æ˜¯åŸºäºç­–ç•¥çš„ã€‚

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter5/Untitled 11.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>


4. ä¸åŒRLæµæ´¾ï¼š
    1. åŸºäºä»·å€¼çš„RLï¼šé€šè¿‡DPè§£å†³RL
        1. ç»å…¸RLå’Œæ§åˆ¶è®º
        2. ä»£è¡¨æ€§ç®—æ³•ï¼šDeep Q-learningå’Œå…¶å˜ç§
        3. ä»£è¡¨ç ”ç©¶äººå‘˜ï¼šRichard Suttonï¼ŒDavid Silver
        4. ä»£è¡¨æœºæ„ï¼šDeepmind
    2. åŸºäºç­–ç•¥çš„RLï¼šé€šè¿‡å­¦ä¹ è§£å†³RL
        1. æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ 
        2. ä»£è¡¨æ€§ç®—æ³•ï¼šPGå’Œå…¶å˜ç§
        3. ä»£è¡¨ç ”ç©¶äººå‘˜ï¼šPieter Abeel, Sergey Levine, John Schulman
        4. ä»£è¡¨æœºæ„ï¼šOpenAI, Berkeley