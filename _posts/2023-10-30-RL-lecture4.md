---
layout: post
title: ç¬¬å››ç«  Value Function Approximation and Deep Q-learning (ä»·å€¼å‡½æ•°è¿‘ä¼¼å’Œæ·±åº¦Qå­¦ä¹ )
date: 2023-10-30
description: VFA and Q-learning
tags: intro
categories: Reinforcement-Learning
giscus_comments: true
related_posts: true
toc:
  beginning: true
---


# ä¸€ã€å‡½æ•°è¿‘ä¼¼

## 1.1 é—®é¢˜å¼•å…¥ï¼šå¤§è§„æ¨¡çš„MDPé—®é¢˜å¦‚ä½•ä¼°è®¡ä»·å€¼å‡½æ•°ï¼Ÿ

åœ¨é¢å¯¹å¤§è§„æ¨¡ MDP é—®é¢˜æ—¶ï¼Œè¦é¿å…ç”¨tableå»è¡¨ç¤ºç‰¹å¾ï¼ˆQ-tabelç­‰ï¼‰ï¼Œè€Œæ˜¯é‡‡ç”¨å¸¦å‚æ•°çš„**å‡½æ•°è¿‘ä¼¼**çš„æ–¹å¼å»è¿‘ä¼¼ä¼°è®¡Vã€Qã€Ï€

1. è¡¨æ ¼å‹æ–¹æ³•
    - åœ¨è¡¨æ ¼å‹æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡æŸ¥è¡¨çš„æ–¹å¼å»è®¡ç®—ä»·å€¼å‡½æ•°çš„
    - æ¯ä¸€ä¸ªçŠ¶æ€-åŠ¨ä½œå¯¹ $$<s,a>$$æœ‰ä¸€ä¸ªå…ƒç´ $$Q(s,a)$$
        
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter4/Untitled.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>
        
2. MDPçš„æŒ‘æˆ˜ï¼š
    - å¤ªå¤šçŠ¶æ€å’ŒåŠ¨ä½œéœ€è¦å­˜ä¸‹æ¥
    - å•ç‹¬å­¦ä¹ æ¯ä¸€ä¸ªçŠ¶æ€çš„ä»·å€¼å¾ˆæ…¢

## 1.2 é€šè¿‡å‡½æ•°è¿‘ä¼¼çš„æ–¹æ³•æ¥è§£å†³å¤§è§„æ¨¡RL

1. å¦‚ä½•éšå¼å­¦ä¹ æˆ–å­˜å‚¨æ¯ä¸ªçŠ¶æ€ï¼Ÿéœ€è¦å­¦ä¹ çš„åŒ…æ‹¬ï¼š
    1. çŠ¶æ€è½¬ç§»æ¨¡å‹ã€å¥–åŠ±æ¨¡å‹
    2. ä»·å€¼å‡½æ•°ï¼ŒQå‡½æ•°
    3. ç­–ç•¥
2. è§£å†³æ–¹æ³•ï¼šé€šè¿‡**ä»·å€¼å‡½æ•°è¿‘ä¼¼ï¼ˆVFAï¼‰**æ¥é€¼è¿‘ã€‚é€šè¿‡å‚æ•°$$\mathbf{w}$$ä¼°è®¡ä»·å€¼å‡½æ•°ã€Qå‡½æ•°å’Œç­–ç•¥ã€‚
    
    $$
    \begin{aligned}\hat{v}(s, \mathbf{w}) & \approx v^\pi(s) \\\hat{q}(s, a, \mathbf{w}) & \approx q^\pi(s, a) \\\hat{\pi}(a, s, \mathbf{w}) & \approx \pi(a \mid s)\end{aligned}
    $$
    
    1. å¯ä»¥ä»è§è¿‡çš„çŠ¶æ€æ³›åŒ–åˆ°æ²¡æœ‰è§åˆ°çš„çŠ¶æ€
    2. å¯ä»¥é€šè¿‡MCæˆ–è€…TDæ–¹æ³•è®­ç»ƒ$$\mathbf{w}$$
3. ä¸€äº›è¿‘ä¼¼æ–¹æ³•ï¼šå…¶ä¸­çº¿æ€§æ–¹æ³•å’Œç¥ç»ç½‘ç»œæ˜¯æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹
    1. ç‰¹å¾çº¿æ€§ç»„åˆ
    2. ç¥ç»ç½‘ç»œ
    3. å†³ç­–æ ‘
    4. æœ€è¿‘é‚»

# äºŒã€é¢„æµ‹ä¸­çš„ä»·å€¼å‡½æ•°è¿‘ä¼¼

## 2.1 æœ‰Oracle/æ¨¡å‹é¢„æµ‹VFA

### 2.1.1 åŸºæœ¬å†…å®¹

1. Oracleï¼šæˆ‘ä»¬çŸ¥é“gtçš„value function $$v^\pi(s)$$ï¼Œå¯¹æ‰€æœ‰çŠ¶æ€$$s$$éƒ½æ˜¯å·²çŸ¥çš„ã€‚
2. æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å­¦ä¹ å¯¹$$v^\pi(s)$$çš„è¿‘ä¼¼ã€‚
3. å› æ­¤æˆ‘ä»¬MSEæ¥å®šä¹‰lossï¼š
    
    $$
    J(\mathbf{w})=\mathbb{E}_\pi\left[\left(v^\pi(s)-\hat{v}(s, \mathbf{w})\right)^2\right]
    $$
    
4. æ¢¯åº¦ä¸‹é™ï¼š
    
    $$
    \begin{aligned}\Delta \mathbf{w} & =-\frac{1}{2} \alpha \nabla_{\mathbf{w}} J(\mathbf{w}) \\\mathbf{w}_{t+1} & =\mathbf{w}_t+\Delta \mathbf{w}\end{aligned}
    $$
    

### 2.1.2 çº¿æ€§æ–¹æ³•

1. å¦‚ä½•é€šè¿‡ç‰¹å¾å‘é‡è¡¨ç¤ºçŠ¶æ€ï¼Ÿ
    
    $$
    \mathbf{x}(s)=\left(x_1(s), \ldots, x_n(s)\right)^T
    $$
    
2. ä»·å€¼å‡½æ•°â€”â€”ç‰¹å¾çº¿æ€§ç»„åˆï¼š

$$
\hat{v}(s, \mathbf{w})=\mathbf{x}(s)^T \mathbf{w}=\sum_{j=1}^n x_j(s) w_j
$$

1. ç›®æ ‡å‡½æ•°ï¼š

$$
J(\mathbf{w})=\mathbb{E}_\pi\left[\left(v^\pi(s)-\mathbf{x}(s)^T \mathbf{w}\right)^2\right]
$$

$$
\Delta \mathbf{w}=\alpha\left(v^\pi(s)-\hat{v}(s, \mathbf{w})\right) \mathbf{x}(s)
$$

ğŸ˜ ***Update = StepSize Ã— PredictionError Ã— FeatureValue***


### 2.1.3 é€šè¿‡æŸ¥ç‰¹å¾è¡¨çš„çº¿æ€§æ–¹æ³•

1. æ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿æ€§VFA
2. æŸ¥è¡¨çš„æ–¹å¼æ˜¯é€šè¿‡1-hotå‘é‡å®ç°çš„ï¼Œç‰¹å¾éƒ½æ˜¯0æˆ–1ï¼š

$$
\mathbf{x}^{\text {table }}(s)=\left(\mathbf{1}\left(s=s_1\right), \ldots, \mathbf{1}\left(s=s_n\right)\right)^T
$$

1. äº‹å®ä¸Šä»·å€¼å‡½æ•°çš„æ¯ä¸€é¡¹æ°å¥½å°±æ˜¯è®­ç»ƒå‚æ•°ï¼š

$$
\hat{v}(s, \mathbf{w})=\left(\mathbf{1}\left(s=s_1\right), \ldots, \mathbf{1}\left(s=s_n\right)\right)\left(w_1, \ldots, w_n\right)^T\\\hat{v}\left(s_k, \mathbf{w}\right)=w_k
$$

## 2.2 æ— æ¨¡å‹é¢„æµ‹VFA

å®è·µä¸­ï¼Œæ²¡æœ‰åŠæ³•çŸ¥é“æ‰€æœ‰çŠ¶æ€çš„gtä»·å€¼å‡½æ•°ï¼Œæ²¡æœ‰oracleã€‚

å›æƒ³ä¸‹åœ¨æ— æ¨¡å‹çš„é¢„æµ‹ä¸­åšçš„äº‹ï¼š

1. ç›®æ ‡æ˜¯å»é€šè¿‡ç»™å®šç­–ç•¥ $$\pi$$ ä¼°è®¡ä»·å€¼å‡½æ•° $$v^\pi$$ 
2. ç»´æŠ¤ä¸€ä¸ª $$v^\pi$$ æˆ–è€… $$q^\pi$$ çš„è¡¨æ ¼
3. æ¯å›åˆè¯„ä¼°æ›´æ–°ï¼ˆMCï¼‰ æˆ– æ¯ä¸€æ­¥è¯„ä¼°æ›´æ–°ï¼ˆTDï¼‰

### 2.2.1 **å¢é‡å¼å‡½æ•°è¿‘ä¼¼é¢„æµ‹ç®—æ³•**ï¼ˆIncremental VFA Prediction Algorithmsï¼‰

1. åœ¨æœ‰gtä»·å€¼å‡½æ•°çš„æƒ…å½¢ä¸‹ï¼Œæˆ‘ä»¬æœ‰ï¼š
    
    $$
    \Delta \mathbf{w}=\alpha\left(\textcolor{red}{v^\pi(s)}-\hat{v}(s, \mathbf{w})\right) \nabla_{\mathbf{w}} \hat{v}\left(s_t, \mathbf{w}\right)
    $$
    
2. åœ¨çœŸå®åœºæ™¯ä¸‹æ²¡æœ‰$$\textcolor{red}{v^\pi(s)}$$ï¼Œæˆ‘ä»¬éœ€è¦å¯»æ±‚æ›¿ä»£æ–¹æ¡ˆï¼š
    - åœ¨MCä¸­ï¼Œæˆ‘ä»¬ç”¨å®é™…returnä»£æ›¿
        
        $$
        \Delta \mathbf{w}=\alpha\left(\textcolor{red}{G_t}-\hat{v}\left(s_t, \mathbf{w}\right)\right) \nabla_{\mathbf{w}} \hat{v}\left(s_t, \mathbf{w}\right)
        $$
        
    - åœ¨TD(0)ä¸­ï¼Œæˆ‘ä»¬ç”¨$$\delta_t$$ä»£æ›¿
        
        $$
        \Delta \mathbf{w}=\alpha\left(\textcolor{red}{R_{t+1}+\gamma \hat{v}\left(s_{t+1}, \mathbf{w}\right)}-\hat{v}\left(s_t, \mathbf{w}\right)\right) \nabla_{\mathbf{w}} \hat{v}\left(s_t, \mathbf{w}\right)
        $$
        

### 2.2.2 åŸºäºVFAçš„MCé¢„æµ‹

1. å¥–åŠ± $$G_t$$  æ˜¯unbiasedçš„ï¼Œä½†æ˜¯å¯¹äºçœŸæ­£çš„value functionæ˜¯å¸¦æœ‰noiseçš„ï¼Œåªæœ‰é‡‡æ ·å¤§é‡çš„$$G_t$$ æ‰èƒ½æ¢å¤å‡º$$v^\pi(s_t)$$ï¼Œå› ä¸º$$\mathbb{E}[G_t]=v^\pi(s_t)$$ã€‚
2. å› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠ $$G_t$$ çœ‹æˆlabelï¼Œ$$S_t$$ çœ‹æˆinputï¼Œåšä¸€ä¸ªç›‘ç£å­¦ä¹ ä»»åŠ¡ã€‚
    
    $$
    <S_1, G_1>,<S_2, G_2>, \ldots,<s_t, G_T> 
    $$
    
3. MCç­–ç•¥è¯„ä¼°æ›´æ–°å¯ä»¥å†™ä¸ºï¼š
    
    $$
    \begin{aligned}
    \Delta \mathbf{w} & =\alpha\left(G_t-\hat{v}\left(s_t, \mathbf{w}\right)\right) \nabla_{\mathbf{w}} \hat{v}\left(s_t, \mathbf{w}\right) \\
    & =\alpha\left(G_t-\hat{v}\left(s_t, \mathbf{w}\right)\right) \mathbf{x}\left(s_t\right)
    \end{aligned}
    $$
    
4. MCé¢„æµ‹åœ¨çº¿æ€§/éçº¿æ€§VFAä¸­éƒ½å¯ä»¥æ”¶æ•›åˆ°globelæœ€ä¼˜ã€‚

### 2.2.3 åŸºäºVFAçš„TDé¢„æµ‹

1. TDç›®æ ‡$$R_{t+1}+\gamma \hat{v}\left(s_{t+1}, \mathbf{w}\right)$$æ˜¯biasedçš„ï¼Œå› ä¸º$$\mathbb{E}[R_{t+1}+\gamma \hat{v}\left(s_{t+1}, \mathbf{w}\right)]\neq v^\pi (s_t)$$
2. æˆ‘ä»¬æœ‰ç±»ä¼¼çš„ç›‘ç£å­¦ä¹ è®­ç»ƒpairå¦‚ä¸‹ï¼š
    
    $$
    <S_1, R_2+\gamma \hat{v}\left(s_2, \mathbf{w}\right)>,<S_2, R_3+\gamma \hat{v}\left(s_3, \mathbf{w}\right)>, \ldots,<S_{T-1}, R_T>
    $$
    
3. TD(0)ä¸­çš„æ›´æ–°å¯ä»¥å†™ä¸ºï¼š
    
    $$
    \begin{aligned}\Delta \mathbf{w} & =\alpha\left(R+\gamma \hat{v}\left(s^{\prime}, \mathbf{w}\right)-\hat{v}(s, \mathbf{w})\right) \nabla_{\mathbf{w}} \hat{v}(s, \mathbf{w}) \\& =\alpha\left(R+\gamma \hat{v}\left(s^{\prime}, \mathbf{w}\right)-\hat{v}(s, \mathbf{w})\right) \mathbf{x}(s)\end{aligned}
    $$
    
    è¿™ä¸ªä¹Ÿå«åšsemi-gradientï¼Œå› ä¸ºæˆ‘ä»¬å¿½ç•¥äº†æ”¹å˜æƒé‡å‘é‡$$\mathbf{w}$$å¯¹äºtargetçš„æ•ˆåº”ã€‚
    
4. çº¿æ€§TD(0)æ‰å¯ä»¥æ”¶æ•›åˆ°globelæœ€ä¼˜ã€‚

# ä¸‰ã€ æ§åˆ¶ä¸­çš„ä»·å€¼å‡½æ•°è¿‘ä¼¼

å¹¿ä¹‰ç­–ç•¥è¿­ä»£ï¼š

        
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter4/Untitled 1.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>

- ç­–ç•¥è¯„ä¼°ï¼šè¿‘ä¼¼ç­–ç•¥è¯„ä¼°ï¼Œ$$\hat{q}(., ., \mathbf{w}) \approx q^\pi$$
- ç­–ç•¥æ”¹è¿›ï¼š$$\varepsilon$$-è´ªå¿ƒç­–ç•¥æ”¹è¿›

## 3.1 æœ‰Oracle/æ¨¡å‹æ§åˆ¶VFA

1. è¿‘ä¼¼åŠ¨ä½œä»·å€¼å‡½æ•°ï¼š
    
    $$
    \hat{q}(s, a, \mathbf{w}) \approx q^\pi(s, a)
    $$
    
2. loss function:
    
    $$
    J(\mathbf{w})=\mathbb{E}_\pi\left[\left(q^\pi(s, a)-\hat{q}(s, a, \mathbf{w})\right)^2\right]
    $$
    
3. æ¢¯åº¦æ±‚è§£ï¼š
    
    $$
    \Delta \mathbf{w}=\alpha\left(q^\pi(s, a)-\hat{q}(s, a, \mathbf{w})\right) \nabla_{\mathbf{w}} \hat{q}(s, a, \mathbf{w})
    $$
    

## 3.2 æ— æ¨¡å‹æ§åˆ¶ä¸­çš„VFA

### 3.2.1 å¢é‡æ§åˆ¶ç®—æ³•ï¼ˆIncremental Control Algorithmï¼‰

ç±»ä¼¼çš„ï¼ŒçœŸå®æƒ…å†µä¸­æˆ‘ä»¬æ²¡æœ‰oracleäº†ã€‚

1. MCï¼š
    
    $$
    \Delta \mathbf{w}=\alpha\left(\textcolor{red}{G_t}-\hat{q}\left(s_t, a_t, \mathbf{w}\right)\right) \nabla_{\mathbf{w}} \hat{q}\left(s_t, a_t, \mathbf{w}\right)
    $$
    
2. Sarsaï¼š
    
    $$
    \Delta \mathbf{w}=\alpha\left(\textcolor{red}{R_{t+1}+\gamma \hat{q}\left(s_{t+1}, a_{t+1}, \mathbf{w}\right)}-\hat{q}\left(s_t, a_t, \mathbf{w}\right)\right) \nabla_{\mathbf{w}} \hat{q}\left(s_t, a_t, \mathbf{w}\right)
    $$
    
3. Q-learningï¼š
    
    $$
    \Delta \mathbf{w}=\alpha\left(\textcolor{red}{R_{t+1}+\gamma \max _a \hat{q}\left(s_{t+1}, a, \mathbf{w}\right)}-\hat{q}\left(s_t, a_t, \mathbf{w}\right)\right) \nabla_{\mathbf{w}} \hat{q}\left(s_t, a_t, \mathbf{w}\right)
    $$
    
4. Semi-gradient Sarsaç®—æ³•æµç¨‹ï¼š
    
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter4/Untitled 2.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>
    

### 3.2.2 æ”¶æ•›æ€§åˆ†æï¼ˆSarsa/Q-learningï¼‰

1. TDä¸­çš„VFAä¸éµä»ä»»ä½•ä¸€ä¸ªLoss function
2. è¿™ä¸ªæ›´æ–°åŒ…å«ä¸¤ä¸ªè¿‘ä¼¼ï¼Œéƒ½ä¼šå¼•å…¥å™ªå£°ï¼š
    1. è´å°”æ›¼å¤‡ä»½å…¬å¼ä¸­çš„è¿‘ä¼¼
    2. è¿‘ä¼¼ä»·å€¼å‡½æ•°çš„è¿‘ä¼¼
3. ä¸€ä¸ªæŒ‘æˆ˜ï¼šè¡Œä¸ºç­–ç•¥å’Œç›®æ ‡ç­–ç•¥ä¸åŒï¼Œå› æ­¤ä»·å€¼å‡½æ•°çš„VFAå¯èƒ½æ²¡æ³•æ”¶æ•›ã€‚
4. æ­»äº¡ä¸‰è§’ï¼š
    1. å‡½æ•°è¿‘ä¼¼ï¼šè¿‘ä¼¼ä¼šå¼•å…¥è¯¯å·®
    2. bootstrapï¼šTDä¾èµ–äºä¹‹å‰çš„ä¼°è®¡ä¼šå¼•å…¥biasï¼ŒMCæ–¹æ³•é¿å…äº†è¿™ä¸ªé—®é¢˜
    3. off-policyè®­ç»ƒï¼šé‡‡æ ·åˆ†å¸ƒå’Œå®é™…åˆ†å¸ƒå·®å¼‚æ¯”è¾ƒå¤§
5. æ”¶æ•›æ€§æ€»ç»“ï¼š
    
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter4/Untitled 3.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>
    

### 3.2.3 batchå¼ºåŒ–å­¦ä¹ 

1. æƒ³æ³•ï¼š
    1. å¢é‡æ¢¯åº¦ä¸‹é™æ›´æ–°æ˜¯ç®€å•çš„ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æœ‰æ•ˆç‡çš„é‡‡æ ·æ–¹å¼ï¼Œæ¯èµ°ä¸€æ­¥ä¼˜åŒ–ä¸€æ¬¡ã€‚
    2. åŸºäºbatchçš„æ–¹æ³•ä¼šæ‰¾ä¸€æ‰¹ä¸­çš„æ•°æ®ã€‚
2. å»ºæ¨¡ï¼šå‡è®¾ç»éªŒåŒ…å«äº†$$<state, value>$$å¯¹ã€‚
    
    $$
    D=\{<s_i,v_i>\}_{t=1}^T
    $$
    
    è¿­ä»£æ—¶é‡å¤ä¸¤æ­¥æ“ä½œï¼š 
    
    1. éšæœºé‡‡æ ·ä¸€å¯¹ï¼Œ$$<s, v^\pi>\sim \mathcal{D}$$
    2. ç”¨æ¢¯åº¦ä¸‹é™æ³•è¿›è¡Œä¼˜åŒ–ï¼š$$\Delta \mathbf{w}=\alpha\left(v^\pi-\hat{v}(s, \mathbf{w})\right) \nabla_{\mathbf{w}} \hat{v}(s, \mathbf{w})$$
    
    ç­‰ä»·äºMSE loss
    
    $$
    \mathbf{w}^{L S}=\underset{\mathbf{w}}{\arg \min } \sum_{t=1}^T\left(v_t^\pi-\hat{v}\left(s_t, \mathbf{w}\right)\right)^2
    $$
    

# ä¸‰ã€æ·±åº¦Qç½‘ç»œ

1. çº¿æ€§VFA vs éçº¿æ€§VFA
    1. çº¿æ€§VFAé€šå¸¸åœ¨ç»™å®šæ­£ç¡®çš„ç‰¹å¾æ—¶æ•ˆæœå¾ˆå¥½ï¼Œä½†æ˜¯éœ€è¦äººå·¥è®¾è®¡ç‰¹å¾é›†ã€‚
    2. éçº¿æ€§VFAä¸éœ€è¦äººå·¥æ¶‰åŠç‰¹å¾ï¼Œç›´æ¥ç”¨DNN
2. æ·±åº¦å¼ºåŒ–å­¦ä¹ 
    1. DNNéœ€è¦è¡¨ç¤ºï¼šä»·å€¼å‡½æ•°ã€ç­–ç•¥å‡½æ•°ä»¥åŠç¯å¢ƒæ¨¡å‹
    2. ä¼˜åŒ–ï¼šSGD

## 3.1 Deep Q-Learning (DQN)

1. DQNé€šè¿‡ç¥ç»ç½‘ç»œè¡¨ç¤ºQå‡½æ•°
2. DQNç©é›…è¾¾åˆ©æ¸¸æˆï¼š
    1. ç«¯åˆ°ç«¯å­¦ä¹ $$Q(s,a)$$ï¼Œç›´æ¥æŠŠåƒç´ å¸§ä½œä¸ºè¾“å…¥
    2. è¾“å…¥æœ€è¿‘4å¸§çŠ¶æ€$$s$$çš„åƒç´ 
    3. è¾“å‡ºæ˜¯$$Q(s,a)$$ä»£è¡¨18ä¸ªæŒ‰é’®ä½ç½®
    4. å¥–åŠ±æ˜¯è¿™ä¸€æ­¥çš„åˆ†æ•°
    
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter4/Untitled 4.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>
    
3. ä¸¤ä¸ªé‡è¦çš„é—®é¢˜ï¼š
    1. æ ·æœ¬ä¹‹é—´çš„å…³ç³»æ€ä¹ˆå¤„ç†ï¼Ÿåƒç´ çº§åˆ«çš„å…³è”å¾ˆé«˜ã€‚è§£å†³ï¼šexperience replay
    2. targetæ˜¯å¸¦æœ‰noiseçš„ã€‚è§£å†³ï¼šå›ºå®šQ targets

## 3.2 DQNï¼šexperience replay

1. ä¸ºäº†å‡å°‘æ ·æœ¬ä¹‹é—´çš„å…³è”æ€§ï¼Œæˆ‘ä»¬æŠŠ $$(s_t,a_t,r_t,s_{t+1})$$ å­˜è¿›ä¸€ä¸ªå›æ”¾çŠ¶æ€è½¬ç§»memory $$D$$ï¼Œè¿™æ˜¯éšæœºæ‰“ä¹±çš„ã€‚å¸Œæœ›é‡‡æ ·å‡ºæ¥çš„ç»éªŒå’Œç›®å‰çŠ¶æ€æ²¡æœ‰å¾ˆå¼ºçš„ç›¸å…³æ€§ã€‚
    
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0 text-center">
        {% include figure.html path="assets/img/RL_chapter4/Untitled 5.png" class="rounded z-depth-1" style="height: 200px;" %}
    </div>
</div>
    
2. ç»éªŒå›æ”¾å…·ä½“æ­¥éª¤ï¼š
    1. åœ¨æ•°æ®é›†ä¸­é‡‡æ ·ç»éªŒï¼š$$\left(s, a, r, s^{\prime}\right) \sim \mathcal{D}$$
    2. è®¡ç®—é‡‡æ ·å‡ºçš„ä»·å€¼ç›®æ ‡ï¼š$$r+\gamma \max _{a^{\prime}} \hat{Q}\left(s^{\prime}, a^{\prime}, \mathbf{w}\right)$$
    3. é€šè¿‡SGDç®—æ³•æ›´æ–°ç½‘ç»œæƒé‡:
        
        $$
        \Delta \mathbf{w}=\alpha\left(r+\gamma \max _{a^{\prime}} \hat{Q}\left(s^{\prime}, a^{\prime}, \mathbf{w}\right)-Q(s, a, \mathbf{w})\right) \nabla_{\mathbf{w}} \hat{Q}(s, a, \mathbf{w})
        $$
        
3. å›ºå®šQç›®æ ‡
    1. ä¸ºäº†æé«˜è®­ç»ƒçš„ç¨³å®šæ€§ï¼Œå¸Œæœ›åœ¨å¤šæ¬¡æ›´æ–°æ—¶ï¼Œè®¡ç®—targetæ—¶å›ºå®šå…¶æƒé‡ã€‚
    2. ç”¨ä¸€ç»„æ–°çš„å‚æ•°$$\mathbf{w^-}$$ä½œä¸ºä½¿ç”¨çš„æƒé‡ï¼Œ$$\mathbf{w}$$æ˜¯æˆ‘ä»¬éœ€è¦æ›´æ–°çš„æƒé‡ã€‚
    3. å›ºå®šç›®æ ‡çš„ç»éªŒå›æ”¾å…·ä½“æ­¥éª¤ï¼š
        1. åœ¨æ•°æ®é›†ä¸­é‡‡æ ·ç»éªŒï¼š$$\left(s, a, r, s^{\prime}\right) \sim \mathcal{D}$$
        2. è®¡ç®—é‡‡æ ·å‡ºçš„ä»·å€¼ç›®æ ‡ï¼š$$r+\gamma \max _{a^{\prime}} \hat{Q}\left(s^{\prime}, a^{\prime}, \textcolor{red}{\mathbf{w}^-} \right)$$
        3. é€šè¿‡SGDç®—æ³•æ›´æ–°ç½‘ç»œæƒé‡:
            
            $$
            \Delta \mathbf{w}=\alpha\left(r+\gamma \max _{a^{\prime}} \hat{Q}\left(s^{\prime}, a^{\prime}, \textcolor{red}{\mathbf{w}^{-}}\right)-Q(s, a, \mathbf{w})\right) \nabla_{\mathbf{w}} \hat{Q}(s, a, \mathbf{w})
            $$
            
    
    ğŸ˜ ä¸ºä»€ä¹ˆéœ€è¦å›ºå®šç›®æ ‡ï¼Ÿ
    ä¸€å¼€å§‹æ›´æ–°çš„æ—¶å€™ï¼Œå¯¹äºQçš„ä¼°è®¡å’ŒQçš„ç›®æ ‡æ¯ä¸€æ­¥éƒ½åœ¨å˜åŒ–ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›Qçš„ä¼°è®¡å¯ä»¥é€¼è¿‘Qçš„ç›®æ ‡ï¼Œé‚£ä¹ˆä¸€ä¸ªå¾ˆå¥½çš„æ–¹å¼å°±æ˜¯å›ºå®šQçš„ç›®æ ‡ï¼Œè®©å¯¹Qçš„ä¼°è®¡æ›´ç²¾å‡†ã€‚
    